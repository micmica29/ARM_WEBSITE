@page
@model ARM_WEBSITE.Pages.AcademicHead.CurriculumModel
@{
    ViewData["Title"] = "Curriculum";
    Layout = "_Layout1";
}
    <style>
        body {
            background-color: #f8f9fa;
        }

        .year-container {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.08);
        }

        .year-header {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 15px;
            border-bottom: 2px solid;
            padding-bottom: 5px;
        }

        .term-container {
            background: #ffffff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            margin-bottom: 15px;
            border-left: 5px solid #BA8E23;
        }

        .table.table-bordered.table-striped th,
        .table.table-bordered.table-striped td {
            text-align: center;
            vertical-align: middle;
        }

        .year-action-row {
            display: flex;
            justify-content: flex-end;
            margin-top: 15px;
        }

        .save-year-btn {
            background-color: #0d6efd;
            border: none;
            color: white;
            border-radius: 8px;
            padding: 6px 12px;
            font-weight: 600;
            transition: background-color 0.2s ease-in-out;
        }

            .save-year-btn:hover {
                background-color: #0b5ed7;
            }

        .archive-btn {
            position: fixed;
            bottom: 20px;
            right: 30px;
            background-color: #dc3545;
            border: none;
            color: white;
            border-radius: 8px;
            padding: 10px 15px;
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
            transition: background-color 0.2s ease-in-out, transform 0.2s ease-in-out;
            z-index: 1000;
            display: none;
        }

            .archive-btn:hover {
                background-color: #bb2d3b;
                transform: scale(1.05);
            }
    </style>

    <div class="container mt-4">
        <h2 class="mb-3">Curriculum</h2>

        <!-- Program + Curriculum Year -->
        <div class="row mb-4 align-items-end">
            <div class="col-md-4">
                <label class="form-label fw-bold">Select Program:</label>
                <select id="programSelect" class="form-select" onchange="showCurriculumYearRow()">
                    <option value="">-- Select Program --</option>
                    <option value="bsit">BSIT - Information Technology</option>
                    <option value="bscs">BSCS - Computer Science</option>
                </select>
            </div>

            <div class="col-md-4 d-none" id="curriculumYearCol">
                <label class="form-label fw-bold">Select Curriculum Year:</label>
                <select id="curriculumYearSelect" class="form-select" onchange="showCurriculum()">
                    <option value="">-- Select Curriculum Year --</option>
                    <option value="2022">2022 Curriculum</option>
                    <option value="2023">2023 Curriculum</option>
                    <option value="2024">2024 Curriculum</option>
                </select>
            </div>

            <div class="col-md-4 text-end d-none" id="addCurriculumBtnCol">
                <button type="button" class="btn btn-primary mt-4" data-bs-toggle="modal" data-bs-target="#addCurriculumModal">
                    + Add Curriculum Year
                </button>
            </div>
        </div>

        <!-- Curriculum Display -->
        <div id="curriculumContainer" class="d-none">
            <div id="yearsContainer"></div>
        </div>

        <button id="archiveBtn" class="archive-btn" onclick="showArchiveConfirm()">📦 Archive Curriculum Year</button>
    </div>

    <!-- Add Curriculum Year Modal -->
    <div class="modal fade" id="addCurriculumModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Curriculum Year</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addCurriculumForm">
                        <div class="mb-3">
                            <label class="form-label">Program</label>
                            <select id="modalProgramSelect" class="form-select" required>
                                <option value="">-- Select Program --</option>
                                <option value="bsit">BSIT - Information Technology</option>
                                <option value="bscs">BSCS - Computer Science</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Curriculum Year</label>
                            <input type="text" class="form-control" id="modalCurriculumYear" placeholder="e.g., 2025" required />
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button class="btn btn-primary" onclick="submitAddCurriculum()">Submit</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Archive Confirmation Modal -->
    <div class="modal fade" id="archiveConfirmModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-danger">Confirm Archive</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="archiveConfirmText"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmArchiveBtn">Archive</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Subject Modal -->
    <div class="modal fade" id="addSubjectModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Add Subject</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addSubjectForm">
                        <input type="hidden" id="termTarget" />
                        <input type="hidden" id="editingRowIndex" />
                        <div class="mb-3">
                            <label class="form-label">Course Code</label>
                            <input type="text" class="form-control" id="courseCode" required />
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Course Name</label>
                            <input type="text" class="form-control" id="courseName" required />
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Lecture Hours</label>
                                <input type="number" class="form-control" id="lecHours" required />
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Lab Hours</label>
                                <input type="number" class="form-control" id="labHours" required />
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Units</label>
                                <input type="number" class="form-control" id="courseUnits" required />
                            </div>
                        </div>
                        <div class="form-check mb-3">
                            <input type="checkbox" class="form-check-input" id="hasCompLab" />
                            <label class="form-check-label">Has Computer Lab</label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveSubject()">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Subject Confirmation Modal -->
    <div class="modal fade" id="deleteConfirmModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-danger">Confirm Delete</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">Are you sure you want to delete this subject?</div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let rowToDelete = null;
        const years = ["1st Year", "2nd Year", "3rd Year", "4th Year"];
        const terms = ["First Term", "Second Term"];

        function showCurriculumYearRow() {
          const program = document.getElementById("programSelect").value;
          document.getElementById("curriculumYearCol").classList.toggle("d-none", !program);
          document.getElementById("addCurriculumBtnCol").classList.toggle("d-none", !program);
          document.getElementById("curriculumContainer").classList.add("d-none");
          if (program) document.getElementById("modalProgramSelect").value = program;
        }

        function showCurriculum() {
          const curriculumYear = document.getElementById("curriculumYearSelect").value;
          const program = document.getElementById("programSelect").value;
          if (!curriculumYear || !program) return;

          const yearsContainer = document.getElementById("yearsContainer");
          yearsContainer.innerHTML = "";

          years.forEach((year, yIndex) => {
            const yearDiv = document.createElement("div");
            yearDiv.className = "year-container";
            yearDiv.innerHTML = `<h4 class="year-header">${year}</h4>`;

            terms.forEach((term, tIndex) => {
              const termDiv = document.createElement("div");
              termDiv.className = "term-container";
              termDiv.innerHTML = `
                <h5>${term}</h5>
                <table class="table table-bordered table-striped text-center">
                  <thead>
                    <tr>
                      <th>Course Code</th><th>Course Name</th>
                      <th>Lec</th><th>Lab</th><th>Units</th>
                      <th>Comp Lab</th><th>Action</th>
                    </tr>
                  </thead>
                  <tbody id="year${yIndex+1}Term${tIndex+1}Subjects"></tbody>
                </table>
                <button class="btn btn-success btn-sm" onclick="openAddModal('${yIndex+1}_${tIndex+1}')">+ Add Subject</button>
              `;
              yearDiv.appendChild(termDiv);
            });

            const actionRow = document.createElement("div");
            actionRow.className = "year-action-row";
            actionRow.innerHTML = `
              <button class="save-year-btn" onclick="saveYearSubjects(${yIndex+1})">💾 Save ${year}</button>
            `;
            yearDiv.appendChild(actionRow);

            yearsContainer.appendChild(yearDiv);
          });

          document.getElementById("curriculumContainer").classList.remove("d-none");
          document.getElementById("archiveBtn").style.display = "inline-block";
        }

        function saveYearSubjects(yearIndex) {
          alert(`✅ Year ${yearIndex} subjects have been saved successfully!`);
        }

        function submitAddCurriculum() {
          const program = document.getElementById("modalProgramSelect").value;
          const curriculumYear = document.getElementById("modalCurriculumYear").value.trim();
          if (!program || !curriculumYear) return alert("Select program and enter curriculum year!");

          const curriculumSelect = document.getElementById("curriculumYearSelect");
          const exists = Array.from(curriculumSelect.options).some(opt => opt.value === curriculumYear);
          if (exists) return alert("Curriculum year already exists!");

          const option = document.createElement("option");
          option.value = curriculumYear;
          option.textContent = `${curriculumYear} Curriculum`;
          curriculumSelect.appendChild(option);

          document.getElementById("programSelect").value = program;
          curriculumSelect.value = curriculumYear;

          showCurriculumYearRow();
          showCurriculum();
          bootstrap.Modal.getInstance(document.getElementById("addCurriculumModal")).hide();
        }

        function showArchiveConfirm() {
          const program = document.getElementById("programSelect").value;
          const curriculumYear = document.getElementById("curriculumYearSelect").value;
          document.getElementById("archiveConfirmText").textContent =
            `Archive the entire curriculum for ${curriculumYear} (${program.toUpperCase()})?`;
          new bootstrap.Modal(document.getElementById("archiveConfirmModal")).show();
        }

        document.getElementById("confirmArchiveBtn").addEventListener("click", () => {
          const curriculumSelect = document.getElementById("curriculumYearSelect");
          const curriculumYear = curriculumSelect.value;
          const optionToRemove = Array.from(curriculumSelect.options).find(opt => opt.value === curriculumYear);
          if (optionToRemove) optionToRemove.remove();
          document.getElementById("yearsContainer").innerHTML = "";
          document.getElementById("curriculumContainer").classList.add("d-none");
          curriculumSelect.value = "";
          bootstrap.Modal.getInstance(document.getElementById("archiveConfirmModal")).hide();
        });

        function openAddModal(termId) {
          document.getElementById("modalTitle").textContent = "Add Subject";
          document.getElementById("termTarget").value = termId;
          document.getElementById("editingRowIndex").value = "";
          document.getElementById("addSubjectForm").reset();
          new bootstrap.Modal(document.getElementById("addSubjectModal")).show();
        }

        function saveSubject() {
          const termId = document.getElementById("termTarget").value;
          const [yearIndex, termIndex] = termId.split("_");
          const tbody = document.getElementById(`year${yearIndex}Term${termIndex}Subjects`);
          const code = document.getElementById("courseCode").value;
          const name = document.getElementById("courseName").value;
          const lec = document.getElementById("lecHours").value;
          const lab = document.getElementById("labHours").value;
          const units = document.getElementById("courseUnits").value;
          const compLab = document.getElementById("hasCompLab").checked ? "Yes" : "No";
          const editingRowIndex = document.getElementById("editingRowIndex").value;
          if (!code || !name || !lec || !lab || !units) return;

          const rowHtml = `<td>${code}</td><td>${name}</td><td>${lec}</td>
                           <td>${lab}</td><td>${units}</td><td>${compLab}</td>
                           <td>
                             <button class="btn btn-outline-primary btn-sm" onclick="editSubject(this, '${termId}')">
                               <i class="bi bi-pencil"></i>
                             </button>
                             <button class="btn btn-outline-danger btn-sm" onclick="askDelete(this)">
                               <i class="bi bi-trash"></i>
                             </button>
                           </td>`;
          if (editingRowIndex) tbody.rows[editingRowIndex].innerHTML = rowHtml;
          else {
            const row = document.createElement("tr");
            row.innerHTML = rowHtml;
            tbody.appendChild(row);
          }
          bootstrap.Modal.getInstance(document.getElementById("addSubjectModal")).hide();
        }

        function askDelete(button) {
          rowToDelete = button.closest("tr");
          new bootstrap.Modal(document.getElementById("deleteConfirmModal")).show();
        }

        document.getElementById("confirmDeleteBtn").addEventListener("click", () => {
          if (rowToDelete) {
            rowToDelete.remove();
            rowToDelete = null;
            bootstrap.Modal.getInstance(document.getElementById("deleteConfirmModal")).hide();
          }
        });

        function editSubject(button, termId) {
          const row = button.closest("tr");
          const cells = row.getElementsByTagName("td");
          const index = row.rowIndex - 1;
          document.getElementById("modalTitle").textContent = "Edit Subject";
          document.getElementById("termTarget").value = termId;
          document.getElementById("editingRowIndex").value = index;
          document.getElementById("courseCode").value = cells[0].textContent;
          document.getElementById("courseName").value = cells[1].textContent;
          document.getElementById("lecHours").value = cells[2].textContent;
          document.getElementById("labHours").value = cells[3].textContent;
          document.getElementById("courseUnits").value = cells[4].textContent;
          document.getElementById("hasCompLab").checked = cells[5].textContent === "Yes";
          new bootstrap.Modal(document.getElementById("addSubjectModal")).show();
        }
    </script>

